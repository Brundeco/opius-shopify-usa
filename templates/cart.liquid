{% comment %} {% render 'preloader-short' %} {% endcomment %}

<div class="wrap mb-12 lg:mb-32">
  <div class=" max-w-screen-2xl mx-auto">
    <div class=" mt-24 lg:mt-28">
      <div class="lg:flex hidden justify-between items-center flex-col">
        <div class=" h-[30vh] bg-red-200 w-full relative">
          <img
            class=" w-full h-full object-cover object-center"
            src="{{ "bottles-event.jpg" | asset_url  }}"
            width=""
            height=""
            alt="cover"
          >
          <div class="absolute inset-0 bg-black opacity-10"></div>
        </div>
        <div class="flex flex-col justify-between items-center w-full py-6">
          <p class=" text-3xl">Cart</p>
          <div class="flex justify-between w-full">
            <div class="flex justify-start items-end">
              <a
                href="/pages/shop"
                class="border border-black px-3 py-2  hover:bg-black hover:text-white duration-300 hidden lg:block"
                >Back to shop</a
              >
            </div>
            {% if cart.items.size > 0 %}
              <div class="flex justify-stretch lg:justify-start w-full lg:max-w-48">
                <a
                  href="/checkout"
                  class="btn bg-black text-white px-4 py-2 mt-2 lg:mt-3 hover:bg-transparent border border-black hover:text-black w-full text-center"
                  >Checkout</a
                >
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% assign delay = 0 %}
      {% if cart.items.size > 0 %}
        <ul class="bg-gray-50 bg-opacity-80 p-5 border border-black border-opacity-10 flex flex-col gap-5">
          {% comment %}
            <div class="flex flex-col lg:flex-row items-center lg:gap-3">
              <p class=" font-semibold uppercase text-xl py-4">Business order?</p>
              <div class="cart__vat">
                <form method="post" action="/cart" class="flex items-center gap-3">
                  <input
                    type="text"
                    name="attributes[vat_number]"
                    id="vat_number"
                    placeholder="Enter VAT number here"
                    class=" px-2 lg:py-2 border border-black text-sm"
                  >
                  <button
                    type="submit"
                    class="btn bg-black text-white px-4 py-2 hover:bg-transparent border border-black hover:text-black duration-300"
                  >
                    Save VAT Number
                  </button>
                </form>
              </div>
            </div>
          {% endcomment %}

          {% for item in cart.items %}
            <li
              data-aos-delay="{{ delay }}"
              data-aos="fade"
              data-aos-duration="1000"
              class=" bg-white p-3"
            >
              <div class="flex flex-col lg:flex-row gap-3">
                <div class=" w-full xl:w-auto flex justify-center">
                  {% if item.image %}
                    <img
                      class=""
                      src="{{ item.image | img_url: 'medium' }}"
                      width=""
                      height=""
                      alt="{{ item.product.title }}"
                    >
                  {% endif %}
                </div>
                <div class="flex justify-between w-full lg:ml-8 flex-col lg:flex-row">
                  <div class="flex flex-col gap-1">
                    <h2 class="text-lg font-medium mb-2">{{ item.product.title }}</h2>
                    {% if item.variant.title != 'Default Title' %}
                      <p>Taal: {{ item.variant.title }}</p>
                    {% endif %}
                    <p class=" my-2">
                      Price: <span class=" font-medium">{{ item.price | money }}</span>
                    </p>

                    <!-- Quantity Input -->
                    <form method="post" action="/cart/update" class="flex items-center gap-2">
                      <input
                        type="number"
                        name="updates[{{ item.key }}]"
                        value="{{ item.quantity }}"
                        min="1"
                        class="border border-gray-300 w-12 text-center h-8 quantity-input"
                        data-item-key="{{ item.key }}"
                      >
                    </form>
                    <p class=" mt-3">Subtotal: {{ item.line_price | money }}</p>
                  </div>

                  <div class="flex justify-between lg:justify-center items-end gap-1.5 mt-6 lg:mt-0">
                    <a
                      class=" bg-black text-white h-8 px-3 py-1 text-nowrap text-sm flex justify-center items-center"
                      href="{{ item.url }}"
                      >View product</a
                    >

                    <!-- Remove from cart -->
                    <form method="post" action="/cart/update" class="">
                      <input type="hidden" name="updates[{{ item.key }}]" value="0">
                      <button
                        type="submit"
                        class="btn border border-black hover:bg-black duration-300 hover:text-white px-3 h-8 flex justify-center items-center"
                      >
                        <i class="fa-solid fa-trash text-xs"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </li>
            {% assign delay = delay | plus: 50 %}
          {% endfor %}
        </ul>

        <!-- Cart subtotal -->
        <div class=" px-4 border border-black border-opacity-10 rounded-md mt-4 py-8 justify-end items-end flex flex-col gap-3">
          {% if cart.total_price >= 14000 %}
            <p class=" text-gray-600 text-sm">Congrats, you're eligible for free shipping</p>
          {% else %}
            <p class=" text-gray-600 text-sm">Free shipping when reaching $140.00 or more</p>
          {% endif %}
          <p class=" text-2xl font-medium">Total: {{ cart.total_price | money }}</p>
          <div class="flex justify-stretch lg:justify-start w-full lg:max-w-48">
            <a
              href="/checkout"
              class="btn bg-black text-white px-4 py-2 mt-2 lg:mt-3 hover:bg-transparent border border-black hover:text-black w-full text-center"
              >Checkout</a
            >
          </div>
          <p class=" font-medium text-sm mt-3">For corporate inquiries or invoices, please contact nguillant@on-bev.com</p>
        </div>
      {% else %}
        <p>Your cart is empty.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.quantity-input').forEach(function (input) {
      let timeout = null;

      input.addEventListener('input', function () {
        clearTimeout(timeout); // Clear previous timeout to prevent excessive form submissions

        timeout = setTimeout(() => {
          this.closest('form').submit(); // Submit form after user stops typing for a short time
        }, 500); // Adjust delay as needed (500ms is a reasonable balance)
      });
    });
  });
</script>
